(()=>{"use strict";const e=(e,t)=>e<0||t<0?-1:(t<e&&([e,t]=[t,e]),Math.floor(Math.random()*(t-e+1))+e),t=t=>t[e(0,t.length-1)],r=(t,r)=>{const s=[];return()=>{let n=e(t,r);if(s.length>=r-t+1)throw new Error("Перебраны все числа из диапазона от "+t+" до "+r);for(;s.includes(n);)n=e(t,r);return s.push(n),n}},s=e=>"Esc"===e.key||"Escape"===e.key,n=e=>e===document.activeElement,o=e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.lineHeight="40px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},c=["Жизнь удалась","Завидно?","Зацени бро!","Агонь!!!!1","Без фильтров","Новая камера","Хороший ракурс","Просто так","Из архива"],l=["Всё отлично!","В целом всё неплохо. Но не всё.","Когда вы делаете фотографию, хорошо бы убирать палец из кадра. В конце концов это просто непрофессионально.","Моя бабушка случайно чихнула с фотоаппаратом в руках и у неё получилась фотография лучше.","Я поскользнулся на банановой кожуре и уронил фотоаппарат на кота и у меня получилась фотография лучше.","Лица у людей на фотке перекошены, как будто их избивают. Как можно было поймать такой неудачный момент?!"],i=["Тирион Ланнистер","Джон Сноу","Дейенерис Таргариен","Серсея Ланнистер","Санса Старк","Арья Старк"],a=r(100,5e3),u=r(1,25),d=r(1,25),m=new Array(25).fill().map((()=>({id:u(),url:"photos/"+d()+".jpg",description:t(c),likes:e(15,200),comments:new Array(e(1,5)).fill().map((()=>(()=>{const r=e(0,l.length-1);return{id:a(),avatar:"img/avatar-"+e(1,6)+".svg",message:l.slice(r,r+e(1,2)),name:t(i)}})()))}))),v=document.querySelector("body"),y=document.querySelector(".text__hashtags"),p=document.querySelector(".text__description"),h=e=>t=>{!s(t)||n(y)||n(p)||(t.preventDefault(),_(e))},g=e=>{v.classList.add("modal-open"),e.classList.remove("hidden"),document.addEventListener("keydown",h(e))},_=e=>{v.classList.remove("modal-open"),e.classList.add("hidden"),document.removeEventListener("keydown",h)},f=e=>{const t=document.querySelectorAll(".picture"),r=document.querySelector(".big-picture"),s=r.querySelector(".big-picture__cancel");t.forEach(((t,s)=>{return t.addEventListener("click",(n=e[s],()=>{g(r),(e=>{const t=document.querySelector("#comment").content.querySelector(".social__comment"),r=document.querySelector(".comments-show-count"),s=document.querySelector(".social__comments"),n=document.querySelector(".comments-loader"),o=document.createDocumentFragment(),c=e.comments,l=c.length;let i,a=5;const u=e=>new Promise((t=>{t(e)})).then((e=>a=e)).then((()=>(i=c.slice(0,a),void(r.textContent=i.length)))).then((()=>{l>5&&i.length<l?(n.classList.remove("hidden"),n.addEventListener("click",d,{once:!0})):n.classList.add("hidden")})).then((()=>s.innerHTML="")).then((()=>(i.forEach((({avatar:e,name:r,message:s})=>{const n=t.cloneNode(!0);n.querySelector(".social__picture").src=e,n.querySelector(".social__picture").alt=r,n.querySelector(".social__text").textContent=s,o.appendChild(n)})),s.appendChild(o)))),d=()=>{u(a+=5)};u(l<5?l:a)})(n),(({url:e,likes:t,comments:r,description:s},n)=>{n.querySelector(".big-picture__img img").src=e,n.querySelector(".likes-count").textContent=t,n.querySelector(".comments-count").textContent=r.length,n.querySelector(".social__caption").textContent=s})(n,r)}));var n})),s.addEventListener("click",(()=>_(r)))},S=document.querySelector(".img-filters"),q=S.querySelector(".img-filters__form");let L;const E=(t,r,s)=>{s&&o(s),new Promise((s=>{s(((t,r)=>{switch(r){case"random":L=((t,r)=>{const s=t.length-r,n=e(0,s);return(e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e})(t.slice(n,n+r))})(t,10);break;case"discussed":L=(e=>{const t=e=>e.comments.length;return e.slice().sort(((e,r)=>{const s=t(e);return t(r)-s}))})(t);break;default:L=t}return L})(t,r))})).then((e=>{(e=>{const t=document.querySelector(".pictures"),r=document.querySelector("#picture").content.querySelector(".picture"),s=document.createDocumentFragment(),n=document.querySelectorAll(".picture");e.forEach((({url:e,likes:t,comments:n})=>{const o=r.cloneNode(!0);o.querySelector(".picture__img").src=e,o.querySelector(".picture__likes").textContent=t,o.querySelector(".picture__comments").textContent=n.length,s.appendChild(o)})),n.forEach((e=>e.remove())),t.appendChild(s)})(e),f(e)}))},w=document.querySelector(".img-upload__scale"),V=w.querySelector(".scale__control--value"),k=w.querySelector(".scale__control--smaller"),x=w.querySelector(".scale__control--bigger"),b=document.querySelector(".img-upload__preview img"),C={MIN:25,MAX:100,step:25,getValue:()=>+V.value.slice(0,-1),reduceValue(){return this.getValue()-this.step},increaseValue(){return this.getValue()+this.step},setOutputValue(e=this.MAX){return e+"%"},setTransformValue(){return`scale(${this.getValue()/100})`},isValidMinValue(){return this.getValue()>this.MIN},isValidMaxValue(){return this.getValue()<this.MAX}},M=e=>{const t=e.target;t===k&&C.isValidMinValue()?V.value=C.setOutputValue(C.reduceValue()):t===x&&C.isValidMaxValue()&&(V.value=C.setOutputValue(C.increaseValue())),b.style.transform=C.setTransformValue()},A=document.querySelector(".effect-level"),T=document.querySelector(".effect-level__value"),$=document.querySelector(".img-upload__preview img"),D=()=>{A.classList.add("hidden"),T.value=0,$.style.filter="none"},F=document.querySelector(".effects__list"),N=document.querySelector(".img-upload__preview img"),O=e=>{const t=e.target;var r;N.className="",t.classList.contains("effects__radio")&&N.classList.add(`effects__preview--${t.value}`),t.classList.contains("effects__radio")&&"none"!==t.value&&(r=t.value,A.classList.contains("hidden")&&A.classList.remove("hidden"),(e=>{const t=A.querySelector(".effect-level__stripe"),r=document.querySelector(".effect-level__bar-toggle"),s=A.querySelector(".effect-level__bar"),n=s.clientWidth,o=s.clientHeight,c=()=>{s.removeEventListener("mousemove",l),window.removeEventListener("mouseup",c)},l=t=>{let r=t.offsetX;const s=t.target.offsetWidth;r=Math.min(s,Math.max(0,r)),i(r,e),a(r)},i=(e,t)=>{const r=Math.round(100*e/n);let s,o,c;switch(t){case"chrome":c="grayscale",o="",s=(r/100).toFixed(1);break;case"sepia":c="sepia",o="",s=(r/100).toFixed(1);break;case"marvin":c="invert",o="%",s=r;break;case"phobos":c="blur",o="px",s=(r/33).toFixed(1);break;case"heat":c="brightness",o="",s=+(r/50).toFixed(1)+1}T.value=s,$.style.filter=c+"("+s+o+")"},a=e=>{const s=r.offsetWidth/2;r.style.left=e-s+"px",t.style.clip="rect(0,"+e+"px,"+o+"px,0)"};s.addEventListener("mousedown",(e=>{e.preventDefault(),s.addEventListener("mousemove",l),window.addEventListener("mouseup",c)})),a(n),i(n,e)})(r)),t.classList.contains("effects__radio")&&"none"===t.value&&D()},W=e=>{const t=e.target,r=t.value.toLowerCase().trim().split(" "),s=r.length;r.forEach((e=>{const s=e.length;var n,o,c;"#"!==e[0]?t.setCustomValidity("Хэш-тег должен начинаться с символа # (решётка)"):s<2?t.setCustomValidity("Еще "+(2-s)+" симв."):(c=e.slice(1),/^[0-9A-ZА-ЯЁ]+$/i.test(c)?20===s?t.setCustomValidity("Лимит длины хэш-тега достигнут"):s>20?t.setCustomValidity("Лимит длины хэш-тега превышен на "+(s-20)+" симв."):(o=e,(n=r).indexOf(o)!==n.lastIndexOf(o)?t.setCustomValidity("Хэш-тег не может быть использован более одного раза"):t.setCustomValidity("")):t.setCustomValidity("Хэш-тег может состоять только из букв и чисел"))})),s>5?t.setCustomValidity("Вы можете указать не более 5 хэш-тегов"):1===s&&""===r[0]&&t.setCustomValidity(""),t.reportValidity()},j=e=>{const t=e.target,r=t.value;((e,t)=>{if("string"==typeof e)return e.length<=140})(r)?t.setCustomValidity(""):t.setCustomValidity("Лимит длины хэш-тега превышен на "+(r.length-140)+" симв."),t.reportValidity()},I=e=>{const t=e.cloneNode(!0);document.body.appendChild(t);const r=e=>{s(e)&&(e.preventDefault(),t.remove(),document.removeEventListener("keydown",r))};t.addEventListener("click",(e=>{const s=t.querySelector("div"),n=t.querySelector("button"),o=e.target;o!==n&&o===s||(t.remove(),document.removeEventListener("keydown",r))})),document.addEventListener("keydown",r)},P=document.querySelector(".img-upload__form"),X=document.querySelector(".text__hashtags"),H=document.querySelector(".text__description"),z=document.querySelector("#success").content.querySelector(".success"),R=document.querySelector("#error").content.querySelector(".error"),U=document.querySelector("#upload-file"),Z=document.querySelector("#upload-cancel"),B=document.querySelector(".img-upload__overlay"),G=document.querySelector(".img-upload__preview img"),J=document.querySelectorAll(".effects__preview"),K=["gif","jpg","jpeg","png"],Q=()=>{_(B),w.removeEventListener("click",M),F.removeEventListener("click",O),X.removeEventListener("input",W),H.removeEventListener("input",j)};var Y,ee;Y=e=>{var t;E(e),t=(t=>{let r=null;return(...t)=>{r&&window.clearTimeout(r),r=window.setTimeout((()=>{(t=>{E(e,t,null)})(...t)}),300)}})(),S.classList.remove("img-filters--inactive"),q.addEventListener("click",(e=>{const r=e.target;r.classList.contains("img-filters__button")&&!r.classList.contains("img-filters__button--active")&&(S.querySelectorAll(".img-filters__button").forEach((e=>{e.classList.contains("img-filters__button--active")&&e.classList.remove("img-filters__button--active")})),r.classList.add("img-filters__button--active"),r.id.endsWith("random")?t("random"):r.id.endsWith("default")?t("default"):r.id.endsWith("discussed")&&t("discussed"))}))},ee=e=>E(m,null,e),fetch("https://23.javascript.pages.academy/kekstagram/data").then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((e=>{Y(e)})).catch((e=>{ee(`Ошибка запроса к серверу "${e.message}". Показаны данные для тестирования`)})),P.addEventListener("submit",(e=>{e.preventDefault(),((e,t,r)=>{fetch("https://23.javascript.pages.academy/kekstagram",{method:"POST",body:r}).then((e=>{if(!e.ok)throw new Error(`${e.status} ${e.statusText}`);Q(),I(z)})).catch((e=>{(e=>{(e=>{Q(),I(R),o(e)})(e)})(`Не удалось отправить форму. Возникла ошибка - "${e.message}". Попробуйте ещё раз`)}))})(0,0,new FormData(e.target))})),U.addEventListener("change",(()=>{const e=U.files[0],t=e.name.toLowerCase(),r=K.some((e=>t.endsWith(e)));new Promise((t=>{if(r){const r=new FileReader;r.addEventListener("load",(()=>{G.src=r.result,J.forEach((e=>e.style.backgroundImage=`url(${r.result})`)),t()})),r.readAsDataURL(e)}})).then((()=>g(B))).then((()=>(V.value=C.setOutputValue(),b.style.transform=C.setTransformValue(),void w.addEventListener("click",M)))).then((()=>(D(),N.className="",void F.addEventListener("click",O)))).then((()=>(X.addEventListener("input",W),void H.addEventListener("input",j))))})),Z.addEventListener("click",Q)})();
//# sourceMappingURL=main.bundle.js.map